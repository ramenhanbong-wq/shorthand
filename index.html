<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì†ê¸°ì‚¬ ì •ë°€ ë¶„ì„ê¸° (ë””ìì¸ ìµœì¢…í˜•)</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; line-height: 1.6; background-color: #2c3e50; }
        .container { max-width: 1100px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { color: #3498db; border-bottom: 3px solid #3498db; padding-bottom: 15px; }
        
        .input-group { display: flex; gap: 20px; margin-bottom: 20px; }
        .box { flex: 1; display: flex; flex-direction: column; }
        textarea { height: 200px; padding: 12px; border: 1px solid #ccc; border-radius: 6px; resize: none; font-size: 18px; line-height: 1.8; }
        
        button { width: 100%; padding: 20px; background-color: #3498db; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 20px; font-weight: bold; }

        /* ì ìˆ˜ ë° ê²°ê³¼ ì˜ì—­ */
        #result { margin-top: 30px; }
        .score-box { text-align: center; background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #eee; }
        .score-text { font-size: 60px; font-weight: 900; color: #3498db; }

        /* í•µì‹¬: ë¶„ì„ ë·° ë””ìì¸ */
        .diff-view { 
            background: #ffffff; padding: 40px; border: 1px solid #eee; border-radius: 15px; 
            font-size: 24px; line-height: 3.5; white-space: pre-wrap; word-break: break-all;
        }

        /* 1. íƒˆì: ë¹¨ê°„ìƒ‰ */
        .d-missing { color: #e74c3c !important; font-weight: bold; background: rgba(231, 76, 60, 0.1); padding: 0 2px; }

        /* 2. ì²¨ì: ì´ˆë¡ìƒ‰ */
        .d-added { color: #27ae60 !important; font-weight: bold; text-decoration: underline; }

        /* 3. ì˜¤ì: íŒŒë€ìƒ‰ (êµì • ì •ë³´ í¬í•¨) */
        .d-wrong { color: #2980b9 !important; font-weight: bold; border-bottom: 2px solid #2980b9; position: relative; display: inline-block; line-height: 1.2; }
        .correction { 
            position: absolute; top: -1.6em; left: 0; font-size: 0.6em; 
            color: #2980b9; background: white; border: 1px solid #2980b9; 
            padding: 1px 4px; border-radius: 3px; white-space: nowrap; font-weight: normal;
        }

        .legend { font-size: 14px; margin-top: 15px; text-align: right; color: #666; }
    </style>
</head>
<body>

<div class="container">
    <h2>âŒ¨ï¸ SHORTHAND MASTER (ì •ë°€ ë§¤ì¹­ ëª¨ë“œ)</h2>
    
    <div class="input-group">
        <div class="box">
            <label>ğŸ“„ ì •ë‹µ ì›ë¬¸</label>
            <textarea id="original">ê·¸ëŸ° ê²½ìš°ì—ëŠ” ë˜ ì–´ë–»ê²Œ ë˜ëŠ” ê²ë‹ˆê¹Œ</textarea>
        </div>
        <div class="box">
            <label>âœï¸ í•™ìƒ ì…ë ¥</label>
            <textarea id="student">ê·¸ëŸ°ê²½ìš°ì—ì–´ì¼€ë˜ëŠ”ê±´ê°€ìš”</textarea>
        </div>
    </div>

    <button onclick="analyzeAndGrade()">ğŸ’¯ ì±„ì  ë° ë¶„ì„ ì‹¤í–‰</button>

    <div id="result" style="display:none;">
        <div class="score-box">
            <div style="font-weight:bold; color:#7f8c8d;">ìµœì¢… ì •í™•ë„</div>
            <div class="score-text"><span id="finalScore">0</span>%</div>
            <div id="scoreDesc" style="color:#95a5a6; font-size:16px;"></div>
        </div>

        <div class="diff-view" id="diffOutput"></div>
        
        <div class="legend">
            <span style="color:#e74c3c">â–  íƒˆì(ë¹¨ê°•)</span> | 
            <span style="color:#2980b9">â–  ì˜¤ì(íŒŒë‘)</span> | 
            <span style="color:#27ae60">â–  ì²¨ì(ì´ˆë¡)</span>
        </div>
    </div>
</div>

<script>
function analyzeAndGrade() {
    let rawO = document.getElementById('original').value;
    let rawS = document.getElementById('student').value;

    // 1. ë„ì–´ì“°ê¸° ë§µ ìƒì„± (ìµœì´ˆ ì½”ë“œì˜ í•µì‹¬ ë¡œì§)
    let spaceMap = []; 
    let pureIdx = 0;
    for (let i = 0; i < rawO.length; i++) {
        if (/\s/.test(rawO[i])) {
            spaceMap[pureIdx] = true; 
        } else {
            pureIdx++;
        }
    }

    // 2. ì „ì²˜ë¦¬ (ê³µë°± ì œê±°)
    const preprocess = (t) => t.replace(/\s/g, '').split('');
    let oArr = preprocess(rawO);
    let sArr = preprocess(rawS);

    // 3. LCS ì•Œê³ ë¦¬ì¦˜
    let n = oArr.length, m = sArr.length;
    let dp = Array.from(Array(n + 1), () => Array(m + 1).fill(0));
    for (let i = 1; i <= n; i++) {
        for (let j = 1; j <= m; j++) {
            dp[i][j] = (oArr[i-1] === sArr[j-1]) ? dp[i-1][j-1]+1 : Math.max(dp[i-1][j], dp[i][j-1]);
        }
    }

    // 4. ì—­ì¶”ì  ë° ì˜¤ì ë³‘í•©
    let i = n, j = m, diffs = [];
    while (i > 0 || j > 0) {
        if (i > 0 && j > 0 && oArr[i-1] === sArr[j-1]) {
            diffs.push({ t: 'same', c: oArr[i-1], idx: i-1 }); i--; j--;
        } else if (j > 0 && (i === 0 || dp[i][j-1] >= dp[i-1][j])) {
            diffs.push({ t: 'added', c: sArr[j-1] }); j--;
        } else {
            diffs.push({ t: 'missing', c: oArr[i-1], idx: i-1 }); i--;
        }
    }
    diffs.reverse();

    // 5. ì¶œë ¥ ìƒì„± (ì„ ìƒë‹˜ ìš”ì²­ ìƒ‰ìƒ ë° ë„ì–´ì“°ê¸° ë³µì›)
    let html = "", w=0, mi=0, ad=0;
    for (let k = 0; k < diffs.length; k++) {
        let cur = diffs[k];
        let next = diffs[k+1];

        // ë„ì–´ì“°ê¸° ë³µì›
        if (cur.idx !== undefined && spaceMap[cur.idx]) html += " ";

        if (cur.t === 'same') {
            html += `<span>${cur.c}</span>`;
        } else if (cur.t === 'missing' && next && next.t === 'added') {
            // ì˜¤ì ì²˜ë¦¬ (íŒŒë‘)
            html += `<span class="d-wrong">${next.c}<span class="correction">${cur.c}</span></span>`;
            w++; k++;
        } else if (cur.t === 'missing') {
            // íƒˆì ì²˜ë¦¬ (ë¹¨ê°•)
            html += `<span class="d-missing">${cur.c}</span>`;
            mi++;
        } else if (cur.t === 'added') {
            // ì²¨ì ì²˜ë¦¬ (ì´ˆë¡)
            html += `<span class="d-added">${cur.c}</span>`;
            ad++;
        }
    }

    // 6. ê²°ê³¼ ë°˜ì˜
    let total = n;
    let score = total > 0 ? Math.max(0, 100 - ((w + mi + ad) / total * 100)).toFixed(1) : 0;
    document.getElementById('finalScore').innerText = score;
    document.getElementById('scoreDesc').innerText = `ì˜¤ì: ${w}, íƒˆì: ${mi}, ì²¨ì: ${ad}`;
    document.getElementById('diffOutput').innerHTML = html;
    document.getElementById('result').style.display = 'block';
}
</script>

</body>
</html>
