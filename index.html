<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHORTHAND PRO - Dashboard</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        :root {
            --bg-body: #F0F4F8; 
            --sidebar-bg: #FFFFFF;
            --primary: #6C5CE7;
            --primary-light: #A29BFE;
            --text-dark: #2D3436;
            --text-grey: #636E72;
            
            /* ì»¬ëŸ¬ì…‹ */
            --c-blue: #E3F2FD; --t-blue: #2196F3;
            --c-pink: #FFEBEE; --t-pink: #E91E63;
            --c-orange: #FFF3E0; --t-orange: #FF9800;

            --shadow-card: 0 4px 20px rgba(0,0,0,0.03);
            --shadow-hover: 0 20px 40px rgba(0,0,0,0.12); 
            --radius-card: 24px;
        }

        body {
            font-family: 'Pretendard', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-dark);
            margin: 0; padding: 0;
            overflow: hidden; 
        }

        /* [ëª¨ë°”ì¼ ê¸°ë³¸ ìˆ¨ê¹€] */
        .mobile-menu-btn { display: none; }
        .sidebar-overlay { display: none; }

        /* --- [1] ë¡œê·¸ì¸ í™”ë©´ --- */
        #login-wrapper {
            display: flex; height: 100vh; width: 100vw;
            background: white; position: fixed; top: 0; left: 0; z-index: 3000;
        }
        .login-art {
            flex: 1.5; background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            display: flex; justify-content: center; align-items: center;
            flex-direction: column; position: relative; overflow: hidden;
        }
        .circle { position: absolute; border-radius: 50%; opacity: 0.6; filter: blur(40px); animation: float 6s infinite ease-in-out; }
        .c1 { width: 300px; height: 300px; background: #FF9A9E; top: 10%; left: 10%; }
        .c2 { width: 400px; height: 400px; background: #A18CD1; bottom: 10%; right: 10%; animation-delay: -3s;}
        
        .login-keyboard-img { 
            width: 200px; z-index: 10; 
            animation: float 4s infinite ease-in-out; 
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.1));
        }

        .login-form-container {
            flex: 1; display: flex; flex-direction: column; 
            justify-content: center; padding: 60px;
            max-width: 500px; background: white; z-index: 2;
            animation: slideUpFade 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .login-title { font-size: 3rem; font-weight: 900; margin-bottom: 10px; color: var(--text-dark); letter-spacing: -1px; }
        .login-sub { font-size: 1.1rem; color: var(--text-grey); margin-bottom: 40px; }
        
        .inp-box {
            width: 100%; padding: 20px; border-radius: 16px; background: #F8F9FA;
            border: 2px solid transparent; margin-bottom: 15px; font-size: 1rem; outline: none; 
            transition: all 0.3s; box-sizing: border-box;
        }
        .inp-box:focus { background: white; border-color: var(--primary); box-shadow: 0 0 0 4px rgba(108, 92, 231, 0.1); transform: translateY(-2px); }
        
        .btn-login {
            width: 100%; padding: 20px; border-radius: 16px; border: none;
            background: var(--primary); color: white; font-size: 1.1rem; font-weight: 800;
            cursor: pointer; transition: all 0.3s; margin-top: 20px;
            box-shadow: 0 10px 20px rgba(108, 92, 231, 0.3);
        }
        .btn-login:hover { transform: translateY(-5px) scale(1.02); box-shadow: 0 15px 30px rgba(108, 92, 231, 0.4); }


        /* --- [2] ë©”ì¸ ì•± ë ˆì´ì•„ì›ƒ --- */
        #app-wrapper {
            display: none; height: 100vh; width: 100vw;
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            width: 260px; background: var(--sidebar-bg);
            padding: 30px 20px; display: flex; flex-direction: column;
            border-right: 1px solid #EAEAEA; flex-shrink: 0;
            z-index: 10;
        }
        .logo { font-size: 1.4rem; font-weight: 900; color: var(--primary); margin-bottom: 40px; padding-left: 10px; }
        
        .nav-list { list-style: none; padding: 0; margin: 0; flex: 1; }
        .nav-item {
            padding: 14px 18px; margin-bottom: 8px; border-radius: 14px;
            color: var(--text-grey); font-weight: 600; cursor: pointer; 
            display: flex; align-items: center; gap: 12px; transition: 0.2s;
            text-decoration: none;
        }
        .nav-item:hover { background: #F5F6FA; color: var(--primary); transform: translateX(5px); }
        .nav-item.active { background: #EEEBFF; color: var(--primary); }
        .nav-icon { width: 24px; text-align: center; font-size: 1.1rem; }

        .profile-card {
            background: #F8F9FA; padding: 15px; border-radius: 16px;
            display: flex; align-items: center; gap: 12px; cursor: pointer; transition: 0.3s;
        }
        .profile-card:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .avatar { width: 40px; height: 40px; background: #D6A2E8; border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; }

        /* ë©”ì¸ ì½˜í…ì¸  */
        .main-content {
            flex: 1; padding: 40px 50px; overflow-y: auto;
            display: flex; flex-direction: column; gap: 25px;
            position: relative;
        }
        .main-content::before {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(108, 92, 231, 0.03) 0%, transparent 40%),
                        radial-gradient(circle, rgba(253, 121, 168, 0.03) 100%, transparent 60%);
            animation: bgMove 20s linear infinite; z-index: -1; pointer-events: none;
        }
        @keyframes bgMove { 0% { transform: translate(0,0); } 50% { transform: translate(-20px, -20px); } 100% { transform: translate(0,0); } }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-20px); } 100% { transform: translateY(0px); } }

        /* ìš”ì†Œë“¤ */
        .header { display: flex; justify-content: space-between; align-items: flex-end; opacity: 0; animation: fadeUp 0.8s forwards 0.2s; }
        .welcome h1 { font-size: 2rem; margin: 0; font-weight: 800; color: var(--text-dark); }
        .welcome p { margin: 8px 0 0 0; color: var(--text-grey); font-size: 1rem; }
        .date-badge { background: white; padding: 10px 20px; border-radius: 30px; font-weight: 700; color: var(--primary); box-shadow: var(--shadow-card); transition: 0.3s; }
        .date-badge:hover { transform: translateY(-3px) rotate(2deg); }

        .notice-banner {
            background: white; border-radius: 16px; padding: 18px 25px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: var(--shadow-card); border-left: 5px solid #FF7675;
            opacity: 0; animation: fadeUp 0.8s forwards 0.3s;
        }
        .notice-content { display: flex; align-items: center; gap: 12px; font-weight: 600; color: #444; }
        .notice-badge { background: #FFEBEE; color: #D63031; padding: 5px 10px; border-radius: 8px; font-size: 0.8rem; font-weight: 800; }
        .notice-close { cursor: pointer; font-size: 1.2rem; color: #aaa; transition: 0.2s; }
        
        .stats-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; opacity: 0; animation: fadeUp 0.8s forwards 0.4s; }
        .stat-card {
            background: white; border-radius: var(--radius-card); padding: 30px;
            box-shadow: var(--shadow-card); display: flex; align-items: center; justify-content: space-between;
            transition: all 0.4s;
        }
        .stat-card:hover { transform: translateY(-8px) scale(1.02); box-shadow: var(--shadow-hover); }
        .stat-info h3 { margin: 5px 0 0 0; font-size: 2.2rem; font-weight: 800; color: var(--text-dark); }
        .stat-info p { margin: 0; color: var(--text-grey); font-size: 0.95rem; font-weight: 600; }
        .stat-icon { 
            width: 60px; height: 60px; border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 30px; 
            animation: iconFloat 3s ease-in-out infinite;
        }
        @keyframes iconFloat { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }
        
        .bg-pink { background: var(--c-pink); color: var(--t-pink); animation-delay: 0s; }
        .bg-blue { background: var(--c-blue); color: var(--t-blue); animation-delay: 0.2s; }
        .bg-orange { background: var(--c-orange); color: var(--t-orange); animation-delay: 0.4s; }

        .mid-section { display: grid; grid-template-columns: 2fr 1fr; gap: 25px; min-height: 320px; opacity: 0; animation: fadeUp 0.8s forwards 0.5s; }
        
        .dashboard-card {
            background: white; border-radius: var(--radius-card); padding: 30px;
            box-shadow: var(--shadow-card); display: flex; flex-direction: column;
            transition: 0.3s;
        }
        .dashboard-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-hover); }

        .card-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .card-head h4 { margin: 0; font-size: 1.2rem; font-weight: 800; }
        
        /* ì°¨íŠ¸ */
        .chart-box { display: flex; align-items: flex-end; justify-content: space-between; flex: 1; padding: 0 15px; }
        .bar-group { display: flex; flex-direction: column; align-items: center; gap: 10px; width: 10%; height: 100%; justify-content: flex-end; }
        .bar { width: 100%; background: #F1F3F5; border-radius: 8px; position: relative; overflow: hidden; height: 100%; }
        .bar-fill { 
            position: absolute; bottom: 0; left: 0; width: 100%; background: var(--primary); border-radius: 8px; 
            height: 0%; transition: height 1.2s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .day-label { font-size: 0.85rem; color: #ADB5BD; font-weight: 600; }

        /* ë­í‚¹ ë¦¬ìŠ¤íŠ¸ */
        .rank-card { background: linear-gradient(135deg, #6C5CE7 0%, #a29bfe 100%); color: white; overflow: hidden; }
        .rank-item {
            display: flex; align-items: center; background: rgba(255,255,255,0.15);
            padding: 12px 15px; border-radius: 14px; margin-bottom: 12px;
            backdrop-filter: blur(5px); transition: 0.2s;
            opacity: 0; animation: slideInRight 0.5s forwards;
        }
        .rank-item:nth-child(1) { animation-delay: 0.8s; }
        .rank-item:nth-child(2) { animation-delay: 1.0s; }
        .rank-item:nth-child(3) { animation-delay: 1.2s; }
        .rank-item:hover { background: rgba(255,255,255,0.25); transform: translateX(5px); }
        .rank-num { font-weight: 800; font-size: 1.2rem; margin-right: 15px; width: 20px; text-align: center; }
        .rank-name { flex: 1; font-weight: 600; font-size: 1rem; }
        .rank-score { font-weight: 700; font-size: 0.95rem; opacity: 0.9; background: white; color: var(--primary); padding: 4px 10px; border-radius: 8px;}

        /* ì•„ì¹´ë°ë¯¸ ì¹´ë“œ */
        .academy-card {
            background: white; border-radius: 20px; padding: 20px 30px;
            display: flex; justify-content: space-between; align-items: center;
            text-decoration: none; color: var(--text-dark);
            box-shadow: var(--shadow-card); transition: 0.3s;
            border: 1px solid rgba(0,0,0,0.03); margin-bottom: 20px;
            opacity: 0; animation: fadeUp 0.8s forwards 0.6s;
        }
        .academy-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(108, 92, 231, 0.15); border-color: var(--primary-light); }
        .ac-content { display: flex; align-items: center; gap: 15px; }
        .ac-icon-img { width: 50px; height: 50px; object-fit: contain; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); transition: 0.3s; }
        .academy-card:hover .ac-icon-img { transform: scale(1.1) rotate(-10deg); }
        .ac-text h3 { margin: 0; font-size: 1.1rem; font-weight: 800; color: var(--text-dark); }
        .ac-text p { margin: 2px 0 0 0; color: #888; font-size: 0.9rem; font-weight: 500;}
        .ac-arrow { font-size: 1.5rem; color: #ddd; font-weight: bold; transition: 0.3s; }
        .academy-card:hover .ac-arrow { color: var(--primary); transform: translateX(5px); }

        @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInRight { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }

        /* ëª¨ë‹¬ & ë¡œë”© */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-box { background: white; width: 400px; padding: 30px; border-radius: 24px; box-shadow: 0 20px 50px rgba(0,0,0,0.2); animation: fadeUp 0.3s; }
        .modal-ta { width: 100%; height: 100px; padding: 15px; margin: 15px 0; border: 2px solid #eee; border-radius: 12px; resize: none; font-family: inherit; box-sizing: border-box;}
        .btn-s { padding: 10px 20px; border-radius: 10px; border: none; cursor: pointer; font-weight: bold; }
        .admin-trigger { margin-top: 20px; border: none; background: none; color: #ccc; cursor: pointer; font-size: 0.8rem; }
        .admin-trigger:hover { color: var(--primary); }

        #loading-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); z-index: 3000; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .spinner { width: 40px; height: 40px; border: 4px solid #eee; border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 0.8s infinite linear; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* --- ëª¨ë°”ì¼ ë°˜ì‘í˜• --- */
        @media (max-width: 768px) {
            body { overflow: auto; }
            #login-wrapper { flex-direction: column; overflow-y: auto; }
            .login-art { flex: 0.4; padding: 40px 0; min-height: 250px; }
            .login-form-container { flex: 1; padding: 40px 20px; }
            
            .sidebar { position: fixed; top: 0; left: 0; height: 100%; transform: translateX(-100%); transition: transform 0.3s ease; z-index: 2000; }
            .sidebar.active { transform: translateX(0); } 
            .sidebar-overlay.active { display: block; background: rgba(0,0,0,0.5); z-index: 1500; position: fixed; top: 0; left: 0; width: 100%; height: 100%; }
            .mobile-menu-btn { display: block; position: fixed; top: 15px; left: 15px; z-index: 1600; background: var(--primary); color: white; border: none; border-radius: 8px; padding: 8px 12px; font-size: 1.5rem; cursor: pointer; }
            .main-content { padding: 70px 20px 20px; width: 100%; box-sizing: border-box; }
            .stats-row { grid-template-columns: 1fr; }
            .mid-section { grid-template-columns: 1fr; }
            .chart-box { height: 200px; padding: 0 5px; }
            .bar-group { width: 12%; }
        }
    </style>
</head>
<body onload="initApp()">

    <div id="loading-overlay"><div class="spinner"></div></div>

    <div id="adminModal" class="modal-overlay">
        <div class="modal-box">
            <h3 style="margin-top:0;">ğŸ“¢ ê³µì§€ì‚¬í•­ ìˆ˜ì •</h3>
            <textarea id="adminNoticeInput" class="modal-ta"></textarea>
            <div style="text-align:right; gap:10px; display:flex; justify-content:flex-end;">
                <button class="btn-s" style="background:#eee;" onclick="closeAdmin()">ì·¨ì†Œ</button>
                <button class="btn-s" style="background:var(--primary); color:white;" onclick="saveNotice()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <div id="login-wrapper">
        <div class="login-art">
            <div class="circle c1"></div>
            <div class="circle c2"></div>
            <img src="keyboard.png" class="login-keyboard-img" alt="Keyboard">
            <h2 style="color:white; font-size:2.5rem; margin-top:20px; z-index:10; text-shadow:0 10px 20px rgba(0,0,0,0.1); font-weight:900;">Speed<br>Typer.</h2>
        </div>
        <div class="login-form-container">
            <div class="login-title">Hello,<br>Master!</div>
            <div class="login-sub">ì˜ˆë¹„ ì†ê¸°ì‚¬ë¥¼ ìœ„í•œ í†µí•© í”Œë«í¼</div>
            
            <input type="text" id="nameInput" class="inp-box" placeholder="ì´ë¦„ (Name)">
            <input type="password" id="pwInput" class="inp-box" placeholder="ë¹„ë°€ë²ˆí˜¸ (Password)" onkeypress="if(event.keyCode==13) login()">
            <button onclick="login()" class="btn-login">ì ‘ì†í•˜ê¸° ğŸš€</button>
        </div>
    </div>

    <div id="app-wrapper">
        <button class="mobile-menu-btn" onclick="toggleSidebar()">â˜°</button>
        <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

        <nav class="sidebar">
            <div class="logo">âš¡ SHORTHAND</div>
            <ul class="nav-list">
                <a class="nav-item active"><span class="nav-icon">ğŸ“Š</span> ëŒ€ì‹œë³´ë“œ</a>
                <a href="editorial.html" class="nav-item"><span class="nav-icon">ğŸ“°</span> ì‚¬ì„¤ì—°ìŠµ</a>
                <a href="toksori2.html" class="nav-item"><span class="nav-icon">ğŸ“</span> ë˜‘ì†Œë¦¬ 2</a>
                <a href="king.html" class="nav-item"><span class="nav-icon">ğŸ‘‘</span> íƒ€ìì™•</a>
                <a href="exam.html" class="nav-item"><span class="nav-icon">ğŸ“</span> ì¡¸ì—…ì‹œí—˜</a>
                <a href="sparta.html" class="nav-item"><span class="nav-icon">ğŸ”¥</span> ìŠ¤íŒŒë¥´íƒ€</a>
                <a href="random.html" class="nav-item"><span class="nav-icon">ğŸ²</span> ì•½ì–´ëœë¤</a>
                <a href="measure.html" class="nav-item"><span class="nav-icon">â±ï¸</span> ììˆ˜ì¸¡ì •</a>
            </ul>
            <div style="margin-top:auto;">
                <div class="profile-card" onclick="logout()">
                    <div class="avatar" id="userAvatar">U</div>
                    <div>
                        <div style="font-weight:700; font-size:0.95rem;" id="userNameSide">User</div>
                        <div style="font-size:0.75rem; color:#888;">ë¡œê·¸ì•„ì›ƒ</div>
                    </div>
                </div>
                <button id="adminBtn" class="admin-trigger" onclick="openAdmin()" style="display:none;">âš™ï¸ Admin Settings</button>
            </div>
        </nav>

        <main class="main-content">
            <div class="header">
                <div class="welcome">
                    <h1 id="welcomeMsg">Welcome back!</h1>
                    <p>ì˜¤ëŠ˜ë„ 100ì  ë§Œì ì— ë„ì „í•˜ì„¸ìš” ğŸ”¥</p>
                </div>
                <div class="date-badge" id="dateBadge">Jan 01</div>
            </div>

            <div id="notice-area" class="notice-banner" style="display:none;">
                <div class="notice-content">
                    <span class="notice-badge">NOTICE</span>
                    <span id="noticeText">ê³µì§€ì‚¬í•­ ë‚´ìš©...</span>
                </div>
                <div class="notice-close" onclick="closeNotice()">Ã—</div>
            </div>

            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-info">
                        <p>ì—°ì† í•™ìŠµì¼</p>
                        <h3 id="streakVal">0ì¼ì§¸</h3> </div>
                    <div class="stat-icon bg-pink">ğŸ”¥</div>
                </div>
                <div class="stat-card">
                    <div class="stat-info">
                        <p>í‰ê·  ì •í™•ë„</p>
                        <h3 id="accVal">0%</h3> </div>
                    <div class="stat-icon bg-blue">ğŸ¯</div>
                </div>
                <div class="stat-card">
                    <div class="stat-info">
                        <p>ìµœê³  íƒ€ìˆ˜</p>
                        <h3 id="cpmVal">0ì</h3> </div>
                    <div class="stat-icon bg-orange">ğŸ†</div>
                </div>
            </div>

            <div class="mid-section">
                <div class="dashboard-card">
                    <div class="card-head">
                        <h4>ğŸ“ˆ ì£¼ê°„ í™œë™ ê·¸ë˜í”„</h4>
                        <span style="font-size:0.85rem; color:#888;">Last 7 Days</span>
                    </div>
                    <div class="chart-box">
                        <div class="bar-group"><div class="bar"><div class="bar-fill"></div></div><span class="day-label">-</span></div>
                        <div class="bar-group"><div class="bar"><div class="bar-fill"></div></div><span class="day-label">-</span></div>
                        <div class="bar-group"><div class="bar"><div class="bar-fill"></div></div><span class="day-label">-</span></div>
                        <div class="bar-group"><div class="bar"><div class="bar-fill"></div></div><span class="day-label">-</span></div>
                        <div class="bar-group"><div class="bar"><div class="bar-fill"></div></div><span class="day-label">-</span></div>
                        <div class="bar-group"><div class="bar"><div class="bar-fill"></div></div><span class="day-label">-</span></div>
                        <div class="bar-group"><div class="bar"><div class="bar-fill"></div></div><span class="day-label">-</span></div>
                    </div>
                </div>

                <div class="dashboard-card rank-card">
                    <div class="card-head" style="color:white;">
                        <h4>ğŸ‘‘ ì‹¤ì‹œê°„ Top 3</h4>
                    </div>
                    <div id="rankListMini">
                        <div style="padding:10px; opacity:0.8;">ë°ì´í„° ë¡œë”© ì¤‘...</div>
                    </div>
                </div>
            </div>

            <a href="https://www.sorizavaacademy.com/" target="_blank" class="academy-card">
                <div class="ac-content">
                    <img class="ac-icon-img" src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Rocket.png" alt="Academy Icon">
                    <div class="ac-text">
                        <h3>ì†Œë¦¬ìë°” ì•„ì¹´ë°ë¯¸</h3>
                        <p>ìˆ˜ê°•ì‹ ì²­ ë° ê³µì‹ í™ˆí˜ì´ì§€ ë°”ë¡œê°€ê¸°</p>
                    </div>
                </div>
                <div class="ac-arrow">â†’</div>
            </a>
            
            <footer style="text-align:center; color:#b2bec3; font-size:0.85rem; padding-bottom:20px;">
                Designed & Developed by <strong>GAEUL</strong>
            </footer>
        </main>
    </div>

<script>
// [âš ï¸ ì£¼ì˜] ë°°í¬ í›„ ì–»ì€ ì›¹ ì•± URLì„ ì•„ë˜ì— ë„£ìœ¼ì„¸ìš”
const GAS_URL = "https://script.google.com/macros/s/AKfycbzbyAeF7AsySRtH4ON71SbUGqAEf4z9nae-d6cle9YmdRFhm3rXL4xTmyp8OdRLl_-lbQ/exec"; 

const ADMIN_NAME = "ê´€ë¦¬ì";
let currentUser = sessionStorage.getItem('shorthand_user');

function initApp() {
    const d = new Date();
    document.getElementById('dateBadge').innerText = `${d.getMonth()+1}ì›” ${d.getDate()}ì¼`;

    if (currentUser) {
        document.getElementById('login-wrapper').style.display = 'none';
        document.getElementById('app-wrapper').style.display = 'flex';
        
        document.getElementById('welcomeMsg').innerText = `ë°˜ê°€ì›Œìš”, ${currentUser}ë‹˜!`;
        document.getElementById('userNameSide').innerText = currentUser;
        document.getElementById('userAvatar').innerText = currentUser.charAt(0);
        
        // ë°ì´í„° ë¡œë“œ
        fetchDashboardData();
        fetchNotice();
        fetchRanking();
        
        if(currentUser === ADMIN_NAME) {
            document.getElementById('adminBtn').style.display = 'block';
        }

        checkAuth();
        setInterval(checkAuth, 60000); // 1ë¶„ë§ˆë‹¤ í† í° ì²´í¬
    } else {
        document.getElementById('login-wrapper').style.display = 'flex';
        document.getElementById('app-wrapper').style.display = 'none';
    }
}

// [í•µì‹¬] ëŒ€ì‹œë³´ë“œ ë°ì´í„° ì—°ë™
async function fetchDashboardData() {
    try {
        const res = await fetch(GAS_URL + `?action=getDashboardData&name=${encodeURIComponent(currentUser)}`);
        const json = await res.json();
        
        if (json.result === "success") {
            const data = json.data;

            // ìŠ¤íƒ¯ ì¹´ë“œ ì—…ë°ì´íŠ¸
            animateValue("streakVal", 0, data.streak, 1500, "ì¼ì§¸");
            animateValue("accVal", 0, Math.round(data.avgAcc), 1500, "%"); 
            animateValue("cpmVal", 0, data.maxCPM, 1500, "ì");

            // ê·¸ë˜í”„ ì—…ë°ì´íŠ¸
            const bars = document.querySelectorAll('.bar');
            const labels = document.querySelectorAll('.day-label');
            const maxVal = data.maxActivity;

            data.graphData.forEach((dayData, index) => {
                if (bars[index]) {
                    const fill = bars[index].querySelector('.bar-fill');
                    labels[index].innerText = dayData.label;
                    
                    let heightPercent = 0;
                    if (maxVal > 0) heightPercent = (dayData.value / maxVal) * 100;
                    
                    setTimeout(() => {
                        fill.style.height = `${heightPercent}%`;
                        fill.title = `${dayData.value}íšŒ ì—°ìŠµ`; 
                    }, 300 + (index * 100));
                }
            });
        }
    } catch (e) {
        console.error("ëŒ€ì‹œë³´ë“œ ì‹¤íŒ¨:", e);
    }
}

// ìˆ«ì ì¹´ìš´íŒ… ì• ë‹ˆë©”ì´ì…˜
function animateValue(id, start, end, duration, suffix) {
    let obj = document.getElementById(id);
    let range = end - start;
    if (range === 0) {
        obj.innerHTML = end + suffix;
        return;
    }
    let current = start;
    let increment = end > start ? 1 : -1;
    let stepTime = Math.abs(Math.floor(duration / range));
    if (stepTime > 100) stepTime = 50; 
    
    let timer = setInterval(function() {
        current += increment;
        obj.innerHTML = current + suffix;
        if (current == end) { clearInterval(timer); }
    }, stepTime);
}

// ë¡œê·¸ì¸
async function login() {
    const name = document.getElementById('nameInput').value.trim();
    const pw = document.getElementById('pwInput').value;
    if(!name || !pw) return alert("ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    
    document.getElementById('loading-overlay').style.display = 'flex';
    try {
        const res = await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "login", name: name, pw: pw }) });
        const data = await res.json();
        
        if (data.result === "success") { 
            currentUser = data.name; 
            sessionStorage.setItem('shorthand_user', currentUser); 
            sessionStorage.setItem('shorthand_token', data.token); 
            initApp(); 
        } else { 
            alert("ë¡œê·¸ì¸ ì‹¤íŒ¨!"); 
        }
    } catch(e) { 
        alert("ì„œë²„ ì—°ê²° ì˜¤ë¥˜"); 
    } finally {
        document.getElementById('loading-overlay').style.display = 'none';
    }
}

function toggleSidebar() {
    const sidebar = document.querySelector('.sidebar');
    const overlay = document.querySelector('.sidebar-overlay');
    sidebar.classList.toggle('active');
    overlay.classList.toggle('active');
}

// ê³µì§€ì‚¬í•­
async function fetchNotice() {
    try {
        const res = await fetch(GAS_URL + "?action=getNotice");
        const data = await res.json();
        if (data.result === "success" && data.notice && data.notice !== "ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤." && !localStorage.getItem('notice_closed_' + getTodayStr())) {
            document.getElementById('noticeText').innerText = data.notice;
            document.getElementById('notice-area').style.display = 'flex';
        }
    } catch(e) {}
}

function closeNotice() {
    document.getElementById('notice-area').style.display = 'none';
    localStorage.setItem('notice_closed_' + getTodayStr(), 'true');
}

function getTodayStr() {
    const d = new Date();
    return `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
}

// ê´€ë¦¬ì (ê³µì§€ ìˆ˜ì •)
function openAdmin() {
    document.getElementById('adminNoticeInput').value = document.getElementById('noticeText').innerText;
    document.getElementById('adminModal').style.display = 'flex';
}
function closeAdmin() { document.getElementById('adminModal').style.display = 'none'; }

async function saveNotice() {
    const txt = document.getElementById('adminNoticeInput').value;
    if(!txt) return;
    try {
        await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "updateNotice", notice: txt }) });
        alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
        document.getElementById('noticeText').innerText = txt;
        document.getElementById('notice-area').style.display = 'flex';
        localStorage.removeItem('notice_closed_' + getTodayStr());
        closeAdmin();
    } catch(e) { alert("ì €ì¥ ì‹¤íŒ¨"); }
}

// ë­í‚¹ (Top 3)
async function fetchRanking() {
    try {
        const res = await fetch(GAS_URL + "?action=getKingData");
        const data = await res.json();
        const list = document.getElementById('rankListMini');
        if (data && data.ranks) {
            list.innerHTML = ""; 
            const top3 = data.ranks.sort((a,b) => b.cpm - a.cpm).slice(0, 3);
            top3.forEach((r, idx) => {
                list.innerHTML += `
                    <div class="rank-item">
                        <span class="rank-num">${idx+1}</span>
                        <span class="rank-name">${r.name}</span>
                        <span class="rank-score">${r.cpm}íƒ€</span>
                    </div>`;
            });
            if(top3.length === 0) list.innerHTML = '<div style="padding:10px;">ì˜¤ëŠ˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        }
    } catch(e) {}
}

function logout() {
    if(confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        sessionStorage.clear();
        location.reload();
    }
}

async function checkAuth() {
    const name = sessionStorage.getItem('shorthand_user');
    const token = sessionStorage.getItem('shorthand_token');
    if (!name || !token) return;
    try {
        await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "checkToken", name: name, token: token }) });
    } catch(e) {}
}
</script>
</body>
</html>

