<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>DDOKSORI S2 | í†µí•© ì •ë°€ ì±„ì  ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { 
            --main-blue: #3498db; --bg: #f4f7f9; --card: #ffffff; --text: #2c3e50; 
        }
        body { font-family: 'Malgun Gothic', sans-serif; background-color: #2c3e50; margin: 0; padding: 20px; color: var(--text); }
        
        /* ì»¨í…Œì´ë„ˆ ë° í—¤ë” */
        .container { max-width: 1200px; margin: 0 auto; background: var(--card); padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .header { border-bottom: 3px solid var(--main-blue); padding-bottom: 15px; margin-bottom: 25px; }

        /* ì…ë ¥ ì˜ì—­ */
        .input-section { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        label { font-weight: bold; color: var(--main-blue); display: block; margin-bottom: 8px; }
        textarea { width: 100%; height: 280px; padding: 15px; border: 1px solid #ddd; border-radius: 12px; font-size: 18px; line-height: 1.8; resize: none; box-sizing: border-box; }

        /* ë²„íŠ¼ */
        .main-btn { width: 100%; padding: 20px; background: var(--main-blue); color: white; border: none; border-radius: 10px; font-size: 22px; font-weight: bold; cursor: pointer; }

        /* ê²°ê³¼ í‘œì‹œ ì°½ (ì„ ìƒë‹˜ ìš”ì²­ ìŠ¤íƒ€ì¼) */
        .diff-view { 
            margin-top: 30px; padding: 40px; border: 1px solid #eee; border-radius: 15px; background: #fff;
            font-size: 24px; line-height: 3.5; white-space: pre-wrap; word-break: keep-all;
        }

        /* ìƒ‰ìƒ ê·œì¹™ ë°˜ì˜ */
        .d-missing { color: #e74c3c !important; font-weight: bold; background: rgba(231, 76, 60, 0.1); padding: 0 2px; } /* íƒˆì: ë¹¨ê°• */
        .d-added { color: #27ae60 !important; font-weight: bold; text-decoration: underline; } /* ì²¨ì: ì´ˆë¡ */
        .d-wrong { color: #2980b9 !important; font-weight: bold; border-bottom: 2px solid #2980b9; position: relative; display: inline-block; line-height: 1.2; } /* ì˜¤ì: íŒŒë‘ */
        
        .correction { 
            position: absolute; top: -1.6em; left: 0; font-size: 0.6em; 
            color: #2980b9; background: white; border: 1px solid #2980b9; 
            padding: 1px 4px; border-radius: 3px; white-space: nowrap; font-weight: normal;
        }

        .score-num { font-size: 70px; font-weight: 900; color: var(--main-blue); text-align: center; margin: 20px 0; }
    </style>
</head>
<body>

<div class="container">
    <div class="header"><h2>âŒ¨ï¸ SHORTHAND MASTER <span style="font-weight:300; font-size:18px;">| ì •ë°€ ì±„ì  ì‹œìŠ¤í…œ</span></h2></div>
    
    <div class="input-section">
        <div><label>ğŸ“„ ì •ë‹µ ì›ë¬¸</label><textarea id="original"></textarea></div>
        <div><label>âœï¸ í•™ìƒ ì…ë ¥</label><textarea id="student"></textarea></div>
    </div>

    <button class="main-btn" onclick="analyzeAndGrade()">ğŸ’¯ ì •ë°€ ì±„ì  ì‹œì‘</button>

    <div id="resultArea" style="display:none;">
        <div class="score-num" id="finalScore">0%</div>
        <p id="scoreDesc" style="text-align:center; font-weight:bold; color:#7f8c8d;"></p>
        <div class="diff-view" id="diffOutput"></div>
    </div>
</div>

<script>
// ë‘ ë‹¨ì–´ì˜ ìœ ì‚¬ë„ ì¸¡ì • (ì–´ì ˆ ë§¤ì¹­ìš©)
function isSimilar(s1, s2) {
    if(!s1 || !s2) return false;
    let match = 0;
    for(let c of s1) if(s2.includes(c)) match++;
    return (match / Math.max(s1.length, s2.length)) > 0.3;
}

// ì–´ì ˆ ë‚´ ê¸€ì ë‹¨ìœ„ ì •ë°€ ë¹„êµ (ì˜¤ì íŒŒë€ìƒ‰, íƒˆì ë¹¨ê°„ìƒ‰, ì²¨ì ì´ˆë¡ìƒ‰ ì ìš©)
function compareCharsInWord(orig, stud) {
    let html = "", w=0, m=0, a=0;
    let i=0, j=0;
    while(i < orig.length || j < stud.length) {
        if(i < orig.length && j < stud.length && orig[i] === stud[j]) {
            html += orig[i]; i++; j++; // ë§ì€ ê¸€ì
        } else {
            let oPart = "", sPart = "";
            while(i < orig.length && (j >= stud.length || orig[i] !== stud[j])) oPart += orig[i++];
            while(j < stud.length && (i >= orig.length || stud[j] !== orig[i])) sPart += stud[j++];
            
            if(oPart && sPart) { // ì˜¤ì (íŒŒë‘)
                html += `<span class="d-wrong">${sPart}<span class="correction">${oPart}</span></span>`;
                w += Math.max(oPart.length, sPart.length);
            } else if(oPart) { // íƒˆì (ë¹¨ê°•)
                html += `<span class="d-missing">${oPart}</span>`;
                m += oPart.length;
            } else if(sPart) { // ì²¨ì (ì´ˆë¡)
                html += `<span class="d-added">${sPart}</span>`;
                a += sPart.length;
            }
        }
    }
    return {html, w, m, a};
}

function analyzeAndGrade() {
    const rawO = document.getElementById('original').value;
    const rawS = document.getElementById('student').value;
    if(!rawO.trim() || !rawS.trim()) return;

    // 1. ì–´ì ˆ ë‹¨ìœ„ë¡œ í° í‹€ ë§¤ì¹­ (ë°€ë¦¼ ë°©ì§€)
    const wordsO = rawO.split(/\s+/);
    const wordsS = rawS.split(/\s+/);

    let n = wordsO.length, m = wordsS.length;
    let dp = Array.from(Array(n + 1), () => Array(m + 1).fill(0));
    for(let i=1; i<=n; i++) {
        for(let j=1; j<=m; j++) {
            dp[i][j] = (isSimilar(wordsO[i-1], wordsS[j-1])) ? dp[i-1][j-1]+1 : Math.max(dp[i-1][j], dp[i][j-1]);
        }
    }

    let i=n, j=m, diffs = [];
    while(i > 0 || j > 0) {
        if(i > 0 && j > 0 && isSimilar(wordsO[i-1], wordsS[j-1])) {
            diffs.push({t:'match', o:wordsO[i-1], s:wordsS[j-1]}); i--; j--;
        } else if(j > 0 && (i === 0 || dp[i][j-1] >= dp[i-1][j])) {
            diffs.push({t:'added', s:wordsS[j-1]}); j--;
        } else {
            diffs.push({t:'missing', o:wordsO[i-1]}); i--;
        }
    }
    diffs.reverse();

    // 2. ì–´ì ˆ ë‚´ ê¸€ì ë‹¨ìœ„ ì •ë°€ ë¶„ì„ ë° ê²°ê³¼ ìƒì„±
    let html = "";
    let wrong = 0, missing = 0, added = 0;
    const totalChars = rawO.replace(/\s/g, '').length;

    diffs.forEach(item => {
        if(item.t === 'match') {
            if(item.o === item.s) {
                html += `<span>${item.s}</span> `; // ì™„ì „ ì¼ì¹˜
            } else {
                let res = compareCharsInWord(item.o, item.s); // ë¶€ë¶„ ì¼ì¹˜ (ì •ë°€ ë¶„ì„)
                html += `<span>${res.html}</span> `;
                wrong += res.w; missing += res.m; added += res.a;
            }
        } else if(item.t === 'missing') {
            html += `<span class="d-missing">${item.o}</span> `; // ì–´ì ˆ ì „ì²´ íƒˆì
            missing += item.o.length;
        } else if(item.t === 'added') {
            html += `<span class="d-added">${item.s}</span> `; // ì–´ì ˆ ì „ì²´ ì²¨ì
            added += item.s.length;
        }
    });

    // 3. ì ìˆ˜ ë° í™”ë©´ ì—…ë°ì´íŠ¸
    let score = totalChars > 0 ? Math.max(0, 100 - ((wrong + missing + added) / totalChars * 100)).toFixed(1) : 0;
    document.getElementById('finalScore').innerText = score + "%";
    document.getElementById('scoreDesc').innerText = `ì˜¤ì(íŒŒë‘): ${wrong} / íƒˆì(ë¹¨ê°•): ${missing} / ì²¨ì(ì´ˆë¡): ${added}`;
    document.getElementById('diffOutput').innerHTML = html;
    document.getElementById('resultArea').style.display = 'block';
}
</script>
</body>
</html>
